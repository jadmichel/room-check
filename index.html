<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>La Veranda Hotel</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f0f2f5; color: #1c1e21; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 450px; margin: auto; }
        h2 { margin-top: 0; color: #1a73e8; text-align: center; margin-bottom: 5px; }
        h3 { text-align: center; color: #606770; margin-top: 0; margin-bottom: 5px; }
        .staff-tag { text-align: center; color: #1a73e8; font-weight: bold; margin-bottom: 20px; font-size: 14px; text-transform: uppercase; }
        .item { display: flex; align-items: flex-start; margin-bottom: 12px; font-size: 15px; border-bottom: 1px solid #f0f0f0; padding-bottom: 8px; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        .item-num { font-weight: bold; margin-right: 8px; color: #1a73e8; min-width: 20px; }
        .status-box { width: 32px; height: 32px; border: 2px solid #ccc; border-radius: 6px; margin-right: 12px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 22px; background: white; transition: 0.2s; }
        .status-ok { color: #25D366; border-color: #25D366; background: #e8f5e9; }
        .status-bad { color: #d93025; border-color: #d93025; background: #ffebee; }
        input[type="password"] { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .note-label { font-size: 14px; color: #d93025; font-weight: bold; margin-top: 15px; display: block; }
        textarea { width: 100%; height: 120px; margin-top: 5px; border-radius: 8px; border: 1px solid #ccc; padding: 10px; box-sizing: border-box; font-size: 16px; font-family: inherit; }
        button { background-color: #25D366; color: white; border: none; padding: 18px; width: 100%; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .login-btn { background-color: #1a73e8; }
        .hidden { display: none; }
        .success { text-align: center; color: #25D366; }
    </style>
</head>
<body>
    <div class="card" id="app">
        <h2>La Veranda Hotel</h2>
        <h3 id="roomDisplay">Room ...</h3>
        <div id="staffDisplay" class="staff-tag hidden"></div>
        <div id="loginArea" class="hidden">
            <p style="text-align:center;">Enter Staff Password:</p>
            <input type="password" id="passInput" placeholder="Password">
            <button class="login-btn" onclick="checkLogin()">LOGIN</button>
            <p id="loginError" style="color:red; display:none; text-align:center;">Wrong Password!</p>
        </div>
        <div id="checklistArea" class="hidden">
            <p style="font-size: 12px; color: #666; text-align: center; margin-bottom: 15px;">Tap 1: OK (✓) | Tap 2: Problem (X)</p>
            <div id="list"></div>
            <label class="note-label">Report Details:</label>
            <textarea id="notes" placeholder="Fill details here..."></textarea>
            <p id="warn" style="color:red; display:none; text-align:center; font-weight:bold;">⚠️ ALL 20 ITEMS MUST BE MARKED!</p>
            <button id="sendBtn" onclick="send()">SEND TO GROUP</button>
        </div>
    </div>
    <script>
        const CHECKS = [
            "Previous guest forgot items in the room",
            "Curtains are well attached and functional",
            "Telephone is in ringing mode",
            "European adaptor is in an electrical socket",
            "AC operates correctly; remote & batteries OK",
            "TV operates correctly; remote & batteries OK",
            "AC switch is ON & taped",
            "Mini-fridge switch ON & taped",
            "Windows & balcony door close & lock properly",
            "Safe box is empty & open",
            "All lighting are ok",
            "Toilet fan is operational",
            "WC seat cover well fixed",
            "Shower flexible not leaking",
            "Shower glass door open and close properly",
            "Towels correct and linen OK",
            "Soap are full",
            "Amenities are correct",
            "Hair dryer OK",
            "Room fully clean & smelling fresh"
        ];

        let itemStates = new Array(CHECKS.length).fill(0);
        let staffData = [];
        let staffName = null;
        const params = new URLSearchParams(window.location.search);
        const room = params.get('r') || "Unknown";
        document.getElementById('roomDisplay').innerText = "Room " + room;

        fetch('cleaners.json?v=' + Date.now()).then(r => r.json()).then(data => { 
            staffData = data; 
            document.getElementById('loginArea').classList.remove('hidden'); 
        });

        function checkLogin() {
            const p = document.getElementById('passInput').value;
            const user = staffData.find(u => u.password === p);
            if (user) { 
                staffName = user.name; 
                document.getElementById('loginArea').classList.add('hidden'); 
                showList(); 
            } else { document.getElementById('loginError').style.display = 'block'; }
        }

        function toggleItem(index) {
            itemStates[index] = (itemStates[index] + 1) % 3;
            renderItems();
            updateNotesFromStates();
        }

        function updateNotesFromStates() {
            let noteArea = document.getElementById('notes');
            let reports = [];
            itemStates.forEach((state, i) => { 
                if (state === 2) {
                    if (i === 0) {
                        reports.push("1- The guest has forgot ");
                    } else {
                        reports.push("item " + (i + 1) + " issue with " + CHECKS[i] + ": ");
                    }
                }
            });
            noteArea.value = reports.join("\n");
        }

        function renderItems() {
            const listDiv = document.getElementById('list');
            listDiv.innerHTML = "";
            CHECKS.forEach((text, i) => {
                let statusClass = ""; let statusChar = "";
                if (itemStates[i] === 1) { statusClass = "status-ok"; statusChar = "✓"; }
                if (itemStates[i] === 2) { statusClass = "status-bad"; statusChar = "✕"; }
                listDiv.innerHTML += `<div class="item" onclick="toggleItem(${i})"><span class="item-num">${i + 1}.</span><div class="status-box ${statusClass}">${statusChar}</div><label style="cursor:pointer;flex-grow:1;">${text}</label></div>`;
            });
        }

        function showList() {
            document.getElementById('staffDisplay').innerText = "Staff: " + staffName;
            document.getElementById('staffDisplay').classList.remove('hidden');
            document.getElementById('checklistArea').classList.remove('hidden');
            renderItems();
        }

        function send() {
            if (!itemStates.every(s => s > 0)) { 
                document.getElementById('warn').style.display = 'block'; 
                return; 
            }
            let noteText = document.getElementById('notes').value.trim();
            const hasProblem = itemStates.includes(2) || noteText.length > 0;
            const now = new Date();
            let msg = "LA VERANDA HOTEL\nROOM " + room + " " + (hasProblem ? "CHECK NOTE" : "READY") + "\n";
            msg += "Staff: " + staffName + "\nDate: " + now.toLocaleDateString() + "\nTime: " + now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) + "\n";
            msg += "Problem: " + (noteText || "All is good");

            window.location.href = "https://wa.me/?text=" + encodeURIComponent(msg);
            sessionStorage.clear();
            document.getElementById('app').innerHTML = `<div class="success"><h2>REPORT SENT</h2><p>Logged out.</p><button onclick="location.reload()" style="background:#1a73e8; color:white; border:none; padding:15px; border-radius:8px; width:100%;">New Room</button></div>`;
        }
    </script>
</body>
</html>
